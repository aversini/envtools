'use strict';var _=require('lodash'),moment=require('moment'),notifier=require('./notifier'),log=require('fedtools-logs'),common=require('../../common');function _timer(a){function b(a){var b,c=0;log.clearPreviousLine(),log.clearPreviousLine(),log.clearPreviousLine(),log.clearPreviousLine(),a?l=log.strToColor('yellow','Remaining time: ')+'expired':(c=parseInt((Date.now()-i)/1e3,10),b=moment.duration(1e3*(d-c)),l=log.strToColor('yellow','Remaining time: ')+b.hours()+'h '+b.minutes()+'m '+b.seconds()+'s'),log.printMessagesInBox([k,l],common.LOG_COLORS.DEFAULT_BOX)}var c,d,e,f,g,h=0,i=Date.now(),j={title:'Envtools Notification',type:'TIMER',message:'Time is up!',sound:'Purr'},k=log.strToColor('cyan','Timer: '),l=log.strToColor('yellow','Remaining time: ')+'***';return g=function(a){function b(a,b){var d=c[b];return d?a*d:0}var c={ms:1e3,s:1000000,m:60000000,h:3600000000,d:86400000000,w:604800000000};return _.isString(a)&&(e=a.toLowerCase().match(/[-+]?[0-9\.]+[a-z]+/g),null!==e&&e.forEach(function(a){var c=a.match(/[0-9\.]+/g)[0],d=a.match(/[a-z]+/g)[0];h+=b(c,d)})),moment.duration(h/c.ms)}(a.strings),c=g.asMilliseconds(),0<c?(d=g.asSeconds(),k+=g.hours()+'h '+g.minutes()+'m '+g.seconds()+'s',log.echo(),log.printMessagesInBox([k,l],common.LOG_COLORS.DEFAULT_BOX),f=setInterval(b,1e3),setTimeout(function(){clearInterval(f),b(d),log.echo(),a.notification&&notifier(null,j)},c),c):-1}module.exports=function(a,b){var c,d=[],e=!_.isBoolean(b.quiet)||!b.quiet;c=_timer({strings:b._[1],notification:e}),-1===c&&(log.echo(),d.push(''),d.push(log.strToColor('yellow','Description:')),d.push('Envtools timer is a simple command line timer'),d.push('with notification superpowers.'),d.push(''),d.push(log.strToColor('yellow','Parameter:')),d.push('Envtools timer only takes one parameter with the'),d.push('following format: XhYmZs, e.g. 4h2m15s or 1m42s'),d.push(''),d.push(log.strToColor('yellow','Usage:')),d.push('$ envtools timer 1m3s'),d.push(''),log.printMessagesInBox(d,common.LOG_COLORS.DEFAULT_BOX),log.echo())};