'use strict';var path=require('path'),log=require('fedtools-logs'),cmd=require('fedtools-commands'),utilities=require('fedtools-utilities');module.exports=function(a){var b=!!process.env.http_proxy,c=path.join(process.env.RUNTIME_DIR,'config.yaml'),d=utilities.isAppInstalled({name:'sinopia',error:'Sinopia is not installed. Install it with npm...'});!0===d&&require('../../bootstrap/plugins/sinopia').installConfiguration({},function(){log.echo(),log.info('Starting Sinopia wrapper provided by Envtools...'),log.info('To start the original Sinopia, type \\sinopia'),cmd.run('sinopia -c '+c,{foreground:!0,verbose:a.debug||!1,status:a.debug||!1,trigger:[{onlyOnce:!0,regex:new RegExp(/http address - http:\/\/localhost:/),callback:function callback(){log.echo(),b?log.success('Sinopia is up and running, using proxy for fallback...'):log.success('Sinopia is up and running, using NO proxy for fallback...'),log.echo('Type CTRL+C to stop it.'),log.echo()}},{regex:new RegExp(/http {2}-->|http {2}<--/),callback:function callback(){log.displaySpinner({msg:'Sinopia is crunching data...',ttl:2e3})}}]},function(a){a&&(log.echo(),log.fatal('Unable to start sinopia... Is it already running?'),log.echo())}),process.on('SIGINT',function(){log.echo(),log.success('Sinopia server stopped.'),process.exit()}),process.on('SIGTERM',function(){log.echo(),log.success('Sinopia server stopped.'),process.exit()})})};