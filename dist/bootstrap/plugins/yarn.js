'use strict';const fs=require('fs-extra'),path=require('path'),waterfall=require('async/waterfall'),parallel=require('async/parallel'),cmd=require('fedtools-commands'),log=require('fedtools-logs'),backup=require('../../utilities/backup'),common=require('../../common'),NPM_CONFIG=path.join(process.env.HOME,'.npmrc'),YARN_CONFIG=path.join(process.env.HOME,'.yarnrc'),YARN_DEST=path.join(process.env.HOME,'.yarn'),YARN_TAR_GZ=path.join(common.ENVTOOLS.THIRDDIR,'yarn','latest.tar.gz');let YARN_BIN='yarn',promptForRestart=!1;module.exports=function(a,b){function c(a,b){let c=[];a?c=a:(c.push('Yarn has been automatically installed for you.'),c.push('You need to restart your session to use it')),process.env.ENVTOOLS_VERSION&&(c.push(''),c.push(`${log.strToColor('cyan','Hint:')} type r ENTER or just restart your terminal...`)),log.echo(),log.printMessagesInBox(c,b?b:common.LOG_COLORS.NOTICE)}backup([NPM_CONFIG,YARN_CONFIG]),waterfall([function(a){fs.emptyDir(YARN_DEST,function(){return a(null)})},function(a){fs.mkdirp(YARN_DEST,function(b){return a(null,b)})},function(a,b){return a||common.isWindows()?b(null):void cmd.run(`tar zxf ${YARN_TAR_GZ} -C ${YARN_DEST} --strip 1`,{status:!1},function(a){a||(YARN_BIN=path.join(process.env.HOME,'.yarn','bin','yarn'),promptForRestart=!0),b(null)})},function(b,c){b&&parallel([function(b){cmd.run('npm config set strict-ssl false',{status:!a.auto},function(){b()})},function(b){const c=`${YARN_BIN} config set strict-ssl false`;cmd.run(c,{status:!a.auto},function(){b()})}],function(a){c(a)})}],function(d){promptForRestart&&c(),a.auto&&d===common.USER_INTERRUPT&&(d=null),d||a.auto||(d=common.USER_IGNORE),b(d,a)})};