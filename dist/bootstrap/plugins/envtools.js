'use strict';const _=require('lodash'),profile=require('./profile'),prompt=require('./prompt'),banner=require('./banner'),version=require('./version'),log=require('fedtools-logs'),inquirer=require('inquirer'),common=require('../../common'),envtoolsCfg=common.ENVTOOLS;module.exports=function(b,c){const a={choices:[envtoolsCfg.CFG_AUTOLOAD,envtoolsCfg.CFG_BANNER,envtoolsCfg.CFG_CUSTOM_PROMPT],custom:common.CUSTOM_PROMPT_DEFAULT},d=prompt.getPrompt(),e=banner.getBanner(),f=b.version.getAutoCheck(),g=[];let h;g.push({name:envtoolsCfg.CFG_AUTOLOAD_LABEL,short:envtoolsCfg.CFG_AUTOLOAD,checked:!0,value:envtoolsCfg.CFG_AUTOLOAD}),common.isZsh()||g.push({name:envtoolsCfg.CFG_CUSTOM_PROMPT_LABEL,short:envtoolsCfg.CFG_CUSTOM_PROMPT,checked:!_.isBoolean(d)||d,value:envtoolsCfg.CFG_CUSTOM_PROMPT}),g.push({name:envtoolsCfg.CFG_BANNER_LABEL,short:envtoolsCfg.CFG_BANNER,checked:e,value:envtoolsCfg.CFG_BANNER},{name:envtoolsCfg.CFG_AUTOCHECK_LABEL,short:envtoolsCfg.CFG_AUTOCHECK,checked:f===common.ON,value:envtoolsCfg.CFG_AUTOCHECK}),h=[{type:'checkbox',name:'choices',message:'Please choose one of more options',when(){return!b.auto},choices:g},{type:'list',name:'custom',message:'Please choose one of the following custom prompts',when(a){if(!common.isZsh()&&0<=_.indexOf(a.choices,envtoolsCfg.CFG_CUSTOM_PROMPT))return!0},default:d-1,choices:[{name:'Prompt with Proxy and Git information',short:'Proxy and Git',value:common.CUSTOM_PROMPT_DEFAULT},{name:'Prompt with Proxy, Git and Node information',short:'Proxy, Git and Node',value:common.CUSTOM_PROMPT_WITH_NODE}]}],inquirer.prompt(h).then(function(d){function e(a,b){profile.setAutoLoad(a,function(){prompt.setPrompt(a,function(){banner.setBanner(a,function(){version(a,function(){b(null,a)})})})})}function f(a,b,c){0<=_.indexOf(a,b)?(g.msg.push(`${c}: ${log.strToColor('green',common.ON)}`),g[b]=common.ON):(g.msg.push(`${c}: ${log.strToColor('yellow',common.OFF)}`),g[b]=common.OFF)}const g={msg:[]},i=b.auto?a:d;f(i.choices,envtoolsCfg.CFG_AUTOLOAD,envtoolsCfg.CFG_AUTOLOAD_LABEL),f(i.choices,envtoolsCfg.CFG_CUSTOM_PROMPT,envtoolsCfg.CFG_CUSTOM_PROMPT_LABEL),f(i.choices,envtoolsCfg.CFG_BANNER,envtoolsCfg.CFG_BANNER_LABEL),f(i.choices,envtoolsCfg.CFG_AUTOCHECK,envtoolsCfg.CFG_AUTOCHECK_LABEL),b.toggleOptions=g,b.toggleOptions.custom=b.auto?a.custom:d.custom,b.auto?e(b,c):(h={type:'confirm',name:'goodToGo',message:'Do you want to continue?',default:!0},log.printMessagesInBox(b.toggleOptions.msg,common.LOG_COLORS.DEFAULT_BOX),inquirer.prompt(h).then(function(d){return d.goodToGo?void e(b,c):c(common.USER_INTERRUPT,b)}))})};