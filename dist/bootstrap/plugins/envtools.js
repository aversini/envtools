'use strict';var _=require('lodash'),profile=require('./profile'),prompt=require('./prompt'),banner=require('./banner'),version=require('./version'),log=require('fedtools-logs'),inquirer=require('inquirer'),common=require('../../common'),envtoolsCfg=common.ENVTOOLS;module.exports=function(b,c){var a,d={choices:[envtoolsCfg.CFG_AUTOLOAD,envtoolsCfg.CFG_BANNER,envtoolsCfg.CFG_CUSTOM_PROMPT],custom:common.CUSTOM_PROMPT_DEFAULT},e=prompt.getPrompt(),f=banner.getBanner(),g=b.version.getAutoCheck(),h=[];h.push({name:envtoolsCfg.CFG_AUTOLOAD_LABEL,short:envtoolsCfg.CFG_AUTOLOAD,checked:!0,value:envtoolsCfg.CFG_AUTOLOAD}),common.isZsh()||h.push({name:envtoolsCfg.CFG_CUSTOM_PROMPT_LABEL,short:envtoolsCfg.CFG_CUSTOM_PROMPT,checked:!_.isBoolean(e)||e,value:envtoolsCfg.CFG_CUSTOM_PROMPT}),h.push({name:envtoolsCfg.CFG_BANNER_LABEL,short:envtoolsCfg.CFG_BANNER,checked:f,value:envtoolsCfg.CFG_BANNER},{name:envtoolsCfg.CFG_AUTOCHECK_LABEL,short:envtoolsCfg.CFG_AUTOCHECK,checked:g===common.ON,value:envtoolsCfg.CFG_AUTOCHECK}),a=[{type:'checkbox',name:'choices',message:'Please choose one of more options',when:function when(){return!b.auto},choices:h},{type:'list',name:'custom',message:'Please choose one of the following custom prompts',when:function when(a){if(!common.isZsh()&&0<=_.indexOf(a.choices,envtoolsCfg.CFG_CUSTOM_PROMPT))return!0},default:e-1,choices:[{name:'Prompt with Proxy and Git information',short:'Proxy and Git',value:common.CUSTOM_PROMPT_DEFAULT},{name:'Prompt with Proxy, Git and Sinopia information',short:'Proxy, Git and Sinopia',value:common.CUSTOM_PROMPT_WITH_SINOPIA},{name:'Prompt with Proxy, Git, Node and Sinopia information',short:'Proxy, Git, Node and Sinopia',value:common.CUSTOM_PROMPT_WITH_SINOPIA_AND_NODE},{name:'Prompt with Proxy, Git and Node information',short:'Proxy, Git and Node',value:common.CUSTOM_PROMPT_WITH_NODE}]}],inquirer.prompt(a).then(function(e){function f(a,b){profile.setAutoLoad(a,function(){prompt.setPrompt(a,function(){banner.setBanner(a,function(){version(a,function(){b(null,a)})})})})}function g(a,b,c){0<=_.indexOf(a,b)?(i.msg.push(c+': '+log.strToColor('green',common.ON)),i[b]=common.ON):(i.msg.push(c+': '+log.strToColor('yellow',common.OFF)),i[b]=common.OFF)}var h,i={msg:[]};h=b.auto?d:e,g(h.choices,envtoolsCfg.CFG_AUTOLOAD,envtoolsCfg.CFG_AUTOLOAD_LABEL),g(h.choices,envtoolsCfg.CFG_CUSTOM_PROMPT,envtoolsCfg.CFG_CUSTOM_PROMPT_LABEL),g(h.choices,envtoolsCfg.CFG_BANNER,envtoolsCfg.CFG_BANNER_LABEL),g(h.choices,envtoolsCfg.CFG_AUTOCHECK,envtoolsCfg.CFG_AUTOCHECK_LABEL),b.toggleOptions=i,b.toggleOptions.custom=b.auto?d.custom:e.custom,b.auto?f(b,c):(a={type:'confirm',name:'goodToGo',message:'Do you want to continue?',default:!0},log.printMessagesInBox(b.toggleOptions.msg,common.LOG_COLORS.DEFAULT_BOX),inquirer.prompt(a).then(function(d){return d.goodToGo?void f(b,c):c(common.USER_INTERRUPT,b)}))})};