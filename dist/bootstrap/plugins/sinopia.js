'use strict';const _=require('lodash'),fs=require('fs-extra'),waterfall=require('async/waterfall'),inquirer=require('inquirer'),path=require('path'),log=require('fedtools-logs'),cmd=require('fedtools-commands'),node=require('./node'),backup=require('../../backup'),common=require('../../common');function _installConfiguration(a,b){const c=path.join(__dirname,'..','..','..','data','third','sinopia','config.yaml'),d=path.join(process.env.RUNTIME_DIR,'config.yaml');let e,f;return fs.existsSync(d)?b(null,a):void fs.readFile(c,function(c,g){return c?b(null,a):(e=_.template(g.toString()),f=e({dir:process.env.RUNTIME_DIR}),f)?void fs.writeFile(d,f,function(){b(null,a)}):b(null,a)})}function _setupSinopia(a,b){waterfall([function(a){const b={type:'list',name:'sinopia',message:'Please choose one of the following options',choices:[{name:'Activate Sinopia',value:common.ON},{name:'Deactivate Sinopia',value:common.OFF}]};inquirer.prompt(b).then(function(b){a(null,b.sinopia)})},function(a,b){fs.writeFile(common.ENVTOOLS.SINOPIA_STATUS,a,function(){b(null,a)})},function(a,b){let c,d,e;backup(node.NPM_CONFIG),a===common.ON?(log.notice('Activating Sinopia...'),c='npm config set registry http://localhost:4873/',cmd.run(c,{status:!0},function(){c='npm config delete proxy',cmd.run(c,{status:!0},function(){log.echo(),log.notice('Please restart your session and Sinopia'),b(common.USER_IGNORE)})})):(log.notice('De-activating Sinopia...'),c='npm config set registry http://registry.npmjs.org/',cmd.run(c,{status:!0},function(){if(!(fs.existsSync(common.ENVTOOLS.PROXY_FILE)&&fs.existsSync(common.ENVTOOLS.PROXY_STATUS_FILE)))return b();return(e=fs.readFileSync(common.ENVTOOLS.PROXY_STATUS_FILE,'utf8'),d=fs.readFileSync(common.ENVTOOLS.PROXY_FILE,'utf8'),''!==d&&e&&e.replace(/\n$/,'')===common.ON)?void(c=`npm config set proxy ${d}`,cmd.run(c,{status:!0},function(){c=`npm config set https-proxy ${d}`,cmd.run(c,{status:!0},function(){b()})})):b()}))}],function(c){b(c,a)})}module.exports={installConfiguration:_installConfiguration,setupSinopia:_setupSinopia};